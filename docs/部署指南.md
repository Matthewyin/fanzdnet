# æ¨ŠæŒ¯ä¸œçƒè¿·ç½‘ç«™AIåº”æ´ç‰©ç”Ÿæˆå™¨ - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
2. [å¼€å‘ç¯å¢ƒéƒ¨ç½²](#å¼€å‘ç¯å¢ƒéƒ¨ç½²)
3. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
4. [Dockeréƒ¨ç½²](#dockeréƒ¨ç½²)
5. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
6. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+) / macOS / Windows 10+
- **å†…å­˜**: æœ€ä½4GBï¼Œæ¨è8GB+
- **å­˜å‚¨**: æœ€ä½20GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºAI APIè°ƒç”¨ï¼‰

### è½¯ä»¶ä¾èµ–
- **Node.js**: 18.0+ (æ¨è18.19.0)
- **Python**: 3.9+ (æ¨è3.11.0)
- **MySQL**: 8.0+
- **Redis**: 6.0+
- **Nginx**: 1.18+ (ç”Ÿäº§ç¯å¢ƒ)

### å¤–éƒ¨æœåŠ¡
- **Google Gemini API**: éœ€è¦æœ‰æ•ˆçš„APIå¯†é’¥
- **åŸŸåå’ŒSSLè¯ä¹¦**: ç”Ÿäº§ç¯å¢ƒéœ€è¦

## ğŸš€ å¼€å‘ç¯å¢ƒéƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/your-repo/fanzdnet-ai-generator.git
cd fanzdnet-ai-generator
```

### 2. æ•°æ®åº“é…ç½®

#### å®‰è£…MySQL
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server

# macOS (ä½¿ç”¨Homebrew)
brew install mysql

# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysql  # Linux
brew services start mysql   # macOS
```

#### åˆ›å»ºæ•°æ®åº“
```bash
mysql -u root -p
```

```sql
CREATE DATABASE fanzd_net CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'fanzdnet'@'localhost' IDENTIFIED BY 'your-secure-password';
GRANT ALL PRIVILEGES ON fanzd_net.* TO 'fanzdnet'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### åˆå§‹åŒ–æ•°æ®åº“è¡¨
```bash
mysql -u fanzdnet -p fanzd_net < database/init_fanzd_net.sql
```

### 3. Redisé…ç½®

#### å®‰è£…Redis
```bash
# Ubuntu/Debian
sudo apt install redis-server

# macOS (ä½¿ç”¨Homebrew)
brew install redis

# å¯åŠ¨RedisæœåŠ¡
sudo systemctl start redis-server  # Linux
brew services start redis          # macOS
```

#### éªŒè¯Redis
```bash
redis-cli ping
# åº”è¯¥è¿”å›: PONG
```

### 4. åç«¯APIæœåŠ¡éƒ¨ç½²

```bash
cd backend/api-service

# å®‰è£…ä¾èµ–
npm install

# å¤åˆ¶ç¯å¢ƒé…ç½®
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**é…ç½®.envæ–‡ä»¶**:
```env
# æœåŠ¡é…ç½®
NODE_ENV=development
PORT=3001
HOST=localhost

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=fanzdnet
DB_PASSWORD=your-secure-password
DB_NAME=fanzd_net

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# æ–‡ä»¶å­˜å‚¨é…ç½®
STORAGE_PATH=../../storage
UPLOAD_PATH=../../storage/uploads
MAX_FILE_SIZE=10485760

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
```

#### å¯åŠ¨APIæœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

### 5. Python AIæœåŠ¡éƒ¨ç½²

```bash
cd backend/ai-service

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/macOS
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¤åˆ¶ç¯å¢ƒé…ç½®
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**é…ç½®.envæ–‡ä»¶**:
```env
# æœåŠ¡é…ç½®
HOST=0.0.0.0
PORT=8000
DEBUG=True
LOG_LEVEL=INFO

# AIæœåŠ¡é…ç½®
GEMINI_API_KEY=your-gemini-api-key-here
AI_REQUEST_TIMEOUT=300
MAX_CONCURRENT_REQUESTS=10

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=1

# MySQLé…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=fanzdnet
DB_PASSWORD=your-secure-password
DB_NAME=fanzd_net

# æ–‡ä»¶å­˜å‚¨é…ç½®
STORAGE_PATH=../../storage
GENERATED_PATH=../../storage/generated
TEMP_PATH=../../storage/temp
```

#### å¯åŠ¨AIæœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
python -m app.main

# æˆ–ä½¿ç”¨uvicorn
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 6. å‰ç«¯åº”ç”¨éƒ¨ç½²

```bash
cd frontpage/ai-generator

# å®‰è£…ä¾èµ–
npm install

# å¤åˆ¶ç¯å¢ƒé…ç½®
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**é…ç½®.envæ–‡ä»¶**:
```env
# APIæœåŠ¡åœ°å€
VITE_API_BASE_URL=http://localhost:3001/api
VITE_AI_API_BASE_URL=http://localhost:8000/api/v1

# åº”ç”¨é…ç½®
VITE_APP_TITLE=æ¨ŠæŒ¯ä¸œçƒè¿·ç½‘ç«™AIåº”æ´ç‰©ç”Ÿæˆå™¨
VITE_APP_VERSION=1.0.0
```

#### å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### 7. åˆ›å»ºå­˜å‚¨ç›®å½•
```bash
mkdir -p storage/{uploads,generated,temp,thumbnails}
chmod 755 storage
chmod 755 storage/*
```

### 8. éªŒè¯éƒ¨ç½²
1. **å‰ç«¯åº”ç”¨**: http://localhost:3000
2. **APIæœåŠ¡**: http://localhost:3001/health
3. **AIæœåŠ¡**: http://localhost:8000/health

## ğŸ­ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. æœåŠ¡å™¨å‡†å¤‡

#### ç³»ç»Ÿæ›´æ–°
```bash
sudo apt update && sudo apt upgrade -y
```

#### å®‰è£…å¿…è¦è½¯ä»¶
```bash
sudo apt install -y curl wget git nginx certbot python3-certbot-nginx
```

#### å®‰è£…Node.js
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

#### å®‰è£…Python
```bash
sudo apt install -y python3 python3-pip python3-venv
```

### 2. æ•°æ®åº“é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

#### MySQLå®‰å…¨é…ç½®
```bash
sudo mysql_secure_installation
```

#### åˆ›å»ºç”Ÿäº§æ•°æ®åº“
```sql
CREATE DATABASE fanzd_net_prod CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'fanzdnet_prod'@'localhost' IDENTIFIED BY 'very-secure-production-password';
GRANT ALL PRIVILEGES ON fanzd_net_prod.* TO 'fanzdnet_prod'@'localhost';
FLUSH PRIVILEGES;
```

### 3. åº”ç”¨éƒ¨ç½²

#### åˆ›å»ºåº”ç”¨ç›®å½•
```bash
sudo mkdir -p /var/www/fanzdnet
sudo chown $USER:$USER /var/www/fanzdnet
cd /var/www/fanzdnet
```

#### å…‹éš†ä»£ç 
```bash
git clone https://github.com/your-repo/fanzdnet-ai-generator.git .
```

#### é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
```bash
# APIæœåŠ¡é…ç½®
cp backend/api-service/.env.example backend/api-service/.env.production

# AIæœåŠ¡é…ç½®
cp backend/ai-service/.env.example backend/ai-service/.env.production

# ç¼–è¾‘ç”Ÿäº§é…ç½®æ–‡ä»¶
nano backend/api-service/.env.production
nano backend/ai-service/.env.production
```

#### å®‰è£…ä¾èµ–å’Œæ„å»º
```bash
# APIæœåŠ¡
cd backend/api-service
npm ci --only=production
cd ../..

# AIæœåŠ¡
cd backend/ai-service
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cd ../..

# å‰ç«¯åº”ç”¨
cd frontpage/ai-generator
npm ci
npm run build
cd ../..
```

### 4. è¿›ç¨‹ç®¡ç†ï¼ˆPM2ï¼‰

#### å®‰è£…PM2
```bash
sudo npm install -g pm2
```

#### åˆ›å»ºPM2é…ç½®æ–‡ä»¶
```bash
nano ecosystem.config.js
```

```javascript
module.exports = {
  apps: [
    {
      name: 'fanzdnet-api',
      script: 'backend/api-service/src/app.js',
      cwd: '/var/www/fanzdnet',
      env: {
        NODE_ENV: 'production',
        PORT: 3001
      },
      instances: 2,
      exec_mode: 'cluster',
      max_memory_restart: '1G',
      error_file: '/var/log/fanzdnet/api-error.log',
      out_file: '/var/log/fanzdnet/api-out.log',
      log_file: '/var/log/fanzdnet/api-combined.log'
    },
    {
      name: 'fanzdnet-ai',
      script: 'backend/ai-service/venv/bin/python',
      args: '-m app.main',
      cwd: '/var/www/fanzdnet/backend/ai-service',
      env: {
        PYTHONPATH: '/var/www/fanzdnet/backend/ai-service'
      },
      instances: 1,
      max_memory_restart: '2G',
      error_file: '/var/log/fanzdnet/ai-error.log',
      out_file: '/var/log/fanzdnet/ai-out.log',
      log_file: '/var/log/fanzdnet/ai-combined.log'
    }
  ]
};
```

#### å¯åŠ¨åº”ç”¨
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/fanzdnet
sudo chown $USER:$USER /var/log/fanzdnet

# å¯åŠ¨åº”ç”¨
pm2 start ecosystem.config.js

# ä¿å­˜PM2é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

### 5. Nginxé…ç½®

#### åˆ›å»ºNginxé…ç½®æ–‡ä»¶
```bash
sudo nano /etc/nginx/sites-available/fanzdnet
```

```nginx
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com www.your-domain.com;
    
    # SSLé…ç½®
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/fanzdnet/frontpage/ai-generator/dist;
        try_files $uri $uri/ /index.html;
        
        # ç¼“å­˜é…ç½®
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # AIæœåŠ¡ä»£ç†
    location /ai-api/ {
        rewrite ^/ai-api/(.*) /api/v1/$1 break;
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # é•¿æ—¶é—´è¯·æ±‚æ”¯æŒï¼ˆAIç”Ÿæˆï¼‰
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }
    
    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 10M;
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
}
```

#### å¯ç”¨ç«™ç‚¹
```bash
sudo ln -s /etc/nginx/sites-available/fanzdnet /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 6. SSLè¯ä¹¦é…ç½®

#### è·å–Let's Encryptè¯ä¹¦
```bash
sudo certbot --nginx -d your-domain.com -d www.your-domain.com
```

#### è®¾ç½®è‡ªåŠ¨ç»­æœŸ
```bash
sudo crontab -e
```

æ·»åŠ ä»¥ä¸‹è¡Œï¼š
```
0 12 * * * /usr/bin/certbot renew --quiet
```

### 7. é˜²ç«å¢™é…ç½®

```bash
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'
sudo ufw enable
```

### 8. ç›‘æ§å’Œæ—¥å¿—

#### è®¾ç½®æ—¥å¿—è½®è½¬
```bash
sudo nano /etc/logrotate.d/fanzdnet
```

```
/var/log/fanzdnet/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        pm2 reload all
    endscript
}
```

## ğŸ³ Dockeréƒ¨ç½²

### 1. åˆ›å»ºDockerfile

#### APIæœåŠ¡Dockerfile
```dockerfile
# backend/api-service/Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 3001

CMD ["npm", "start"]
```

#### AIæœåŠ¡Dockerfile
```dockerfile
# backend/ai-service/Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "-m", "app.main"]
```

### 2. åˆ›å»ºdocker-compose.yml

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: fanzd_net
      MYSQL_USER: fanzdnet
      MYSQL_PASSWORD: password
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/init_fanzd_net.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"

  redis:
    image: redis:6-alpine
    ports:
      - "6379:6379"

  api-service:
    build: ./backend/api-service
    environment:
      NODE_ENV: production
      DB_HOST: mysql
      REDIS_HOST: redis
    ports:
      - "3001:3001"
    depends_on:
      - mysql
      - redis
    volumes:
      - ./storage:/app/storage

  ai-service:
    build: ./backend/ai-service
    environment:
      DB_HOST: mysql
      REDIS_HOST: redis
      GEMINI_API_KEY: ${GEMINI_API_KEY}
    ports:
      - "8000:8000"
    depends_on:
      - mysql
      - redis
    volumes:
      - ./storage:/app/storage

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./frontpage/ai-generator/dist:/usr/share/nginx/html
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - api-service
      - ai-service

volumes:
  mysql_data:
```

### 3. å¯åŠ¨DockeræœåŠ¡

```bash
# æ„å»ºå’Œå¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## âš ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
sudo systemctl status mysql

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 3306

# æµ‹è¯•è¿æ¥
mysql -h localhost -u fanzdnet -p fanzd_net
```

#### 2. Redisè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
sudo systemctl status redis-server

# æµ‹è¯•è¿æ¥
redis-cli ping
```

#### 3. AIæœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥Pythonç¯å¢ƒ
python3 --version
pip list

# æ£€æŸ¥Gemini APIå¯†é’¥
echo $GEMINI_API_KEY

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
tail -f /var/log/fanzdnet/ai-error.log
```

#### 4. å‰ç«¯æ„å»ºå¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜
npm cache clean --force

# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version
npm --version
```

#### 5. Nginxé…ç½®é”™è¯¯
```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•
ALTER TABLE fazd_generation_records ADD INDEX idx_user_status (user_id, status);
ALTER TABLE fazd_file_records ADD INDEX idx_user_type (user_id, file_type);

-- ä¼˜åŒ–é…ç½®
SET GLOBAL innodb_buffer_pool_size = 1073741824; -- 1GB
```

#### 2. Redisä¼˜åŒ–
```bash
# ç¼–è¾‘Redisé…ç½®
sudo nano /etc/redis/redis.conf

# è®¾ç½®æœ€å¤§å†…å­˜
maxmemory 512mb
maxmemory-policy allkeys-lru
```

#### 3. Node.jsä¼˜åŒ–
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export NODE_OPTIONS="--max-old-space-size=2048"
```

---

**éƒ¨ç½²æ”¯æŒ**: deploy-support@fanzdnet.com  
**æ›´æ–°æ—¶é—´**: 2024å¹´12æœˆ  
**ç‰ˆæœ¬**: v1.0.0
