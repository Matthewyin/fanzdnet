# æ¨ŠæŒ¯ä¸œçƒè¿·ç½‘ç«™ - ç«¯å£é…ç½®è¯´æ˜

## ğŸŒ **ç«¯å£åˆ†é…æ–¹æ¡ˆ**

### **ä¸»è¦æœåŠ¡ç«¯å£**
| æœåŠ¡åç§° | ç«¯å£å· | æè¿° | çŠ¶æ€ |
|---------|--------|------|------|
| å‰ç«¯åº”ç”¨ | 3000 | Vue.jsä¸»ç½‘ç«™ | âœ… å·²é…ç½® |
| APIæœåŠ¡ | 27001 | ä¸»APIæœåŠ¡ | âœ… å·²é…ç½® |
| AIæœåŠ¡ | 27002 | AIåº”æ´ç‰©ç”ŸæˆæœåŠ¡ | âœ… å·²é…ç½® |
| æ–°é—»æœåŠ¡ | 27005 | æ–°é—»çˆ¬è™«å’Œç®¡ç†æœåŠ¡ | âœ… å·²é…ç½® |
| èµ›ç¨‹æœåŠ¡ | 27006 | æ¯”èµ›èµ›ç¨‹ç®¡ç†æœåŠ¡ | âœ… å·²é…ç½® |
| APIç½‘å…³ | 27007 | ç»Ÿä¸€APIç½‘å…³ | âœ… å·²é…ç½® |

### **ç›‘æ§å’Œè¾…åŠ©ç«¯å£**
| æœåŠ¡åç§° | ç«¯å£å· | æè¿° | çŠ¶æ€ |
|---------|--------|------|------|
| AIç›‘æ§ | 27008 | AIæœåŠ¡ç›‘æ§æŒ‡æ ‡ | âœ… å·²é…ç½® |
| ç½‘å…³ç›‘æ§ | 27009 | APIç½‘å…³ç›‘æ§æŒ‡æ ‡ | âœ… å·²é…ç½® |

## ğŸ“ **é…ç½®æ–‡ä»¶ä½ç½®**

### **åç«¯æœåŠ¡é…ç½®**
```
backend/
â”œâ”€â”€ api-service/
â”‚   â”œâ”€â”€ .env                    # PORT=27001
â”‚   â””â”€â”€ .env.example           # PORT=27001
â”œâ”€â”€ ai-service/
â”‚   â”œâ”€â”€ .env                    # PORT=27002, METRICS_PORT=27008
â”‚   â””â”€â”€ .env.example           # PORT=27002, METRICS_PORT=27008
news-service/
â”œâ”€â”€ .env.example               # PORT=27005
â””â”€â”€ package.json               # æœåŠ¡é…ç½®
schedule-service/
â”œâ”€â”€ .env.example               # PORT=27006
â””â”€â”€ package.json               # æœåŠ¡é…ç½®
api-gateway/
â”œâ”€â”€ .env.example               # PORT=27007, METRICS_PORT=27009
â””â”€â”€ package.json               # æœåŠ¡é…ç½®
```

### **å‰ç«¯é…ç½®**
```
frontpage/
â”œâ”€â”€ .env                       # APIåœ°å€é…ç½®
â”œâ”€â”€ .env.example              # APIåœ°å€é…ç½®
â”œâ”€â”€ vite.config.js            # ä»£ç†é…ç½®
â””â”€â”€ ai-generator/
    â”œâ”€â”€ .env                   # ç‹¬ç«‹AIç”Ÿæˆå™¨é…ç½®
    â”œâ”€â”€ .env.example          # ç‹¬ç«‹AIç”Ÿæˆå™¨é…ç½®
    â””â”€â”€ vite.config.js        # ä»£ç†é…ç½®
```

## ğŸ”§ **æœåŠ¡é—´é€šä¿¡é…ç½®**

### **APIç½‘å…³è·¯ç”±é…ç½®**
```env
# api-gateway/.env
API_SERVICE_URL=http://localhost:27001
AI_SERVICE_URL=http://localhost:27002
NEWS_SERVICE_URL=http://localhost:27005
SCHEDULE_SERVICE_URL=http://localhost:27006
```

### **å‰ç«¯ä»£ç†é…ç½®**
```javascript
// frontpage/vite.config.js
proxy: {
  '/api': {
    target: 'http://localhost:27007',  // é€šè¿‡APIç½‘å…³
    changeOrigin: true
  },
  '/api/auth': {
    target: 'http://localhost:27001',  // ç›´è¿APIæœåŠ¡
    changeOrigin: true
  },
  '/api/ai': {
    target: 'http://localhost:27002',  // ç›´è¿AIæœåŠ¡
    changeOrigin: true
  }
}
```

## ğŸš€ **å¯åŠ¨è„šæœ¬**

### **å®Œæ•´å¯åŠ¨**
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-all-services.sh

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:27007/health  # APIç½‘å…³
curl http://localhost:27001/health  # APIæœåŠ¡
curl http://localhost:27002/health  # AIæœåŠ¡
```

### **åœæ­¢æ‰€æœ‰æœåŠ¡**
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop-all-services.sh
```

### **å•ç‹¬å¯åŠ¨æœåŠ¡**
```bash
# APIæœåŠ¡
cd backend/api-service && npm run dev

# AIæœåŠ¡
cd backend/ai-service && python -m app.main

# æ–°é—»æœåŠ¡
cd news-service && npm run dev

# èµ›ç¨‹æœåŠ¡
cd schedule-service && npm run dev

# APIç½‘å…³
cd api-gateway && npm run dev

# å‰ç«¯åº”ç”¨
cd frontpage && npm run dev
```

## ğŸ” **ç«¯å£æ£€æŸ¥å‘½ä»¤**

### **æ£€æŸ¥ç«¯å£å ç”¨**
```bash
# æ£€æŸ¥æ‰€æœ‰ç›¸å…³ç«¯å£
for port in 3000 27001 27002 27005 27006 27007 27008 27009; do
  echo "ç«¯å£ $port:"
  lsof -i :$port
  echo "---"
done
```

### **é‡Šæ”¾ç«¯å£**
```bash
# æ€æ­»å ç”¨ç‰¹å®šç«¯å£çš„è¿›ç¨‹
lsof -ti:ç«¯å£å· | xargs kill -9

# ä¾‹å¦‚ï¼šé‡Šæ”¾27001ç«¯å£
lsof -ti:27001 | xargs kill -9
```

## ğŸŒ **ç¯å¢ƒå˜é‡é…ç½®**

### **å¼€å‘ç¯å¢ƒ**
```env
# æ‰€æœ‰æœåŠ¡ä½¿ç”¨localhost
API_SERVICE_URL=http://localhost:27001
AI_SERVICE_URL=http://localhost:27002
NEWS_SERVICE_URL=http://localhost:27005
SCHEDULE_SERVICE_URL=http://localhost:27006
API_GATEWAY_URL=http://localhost:27007
```

### **ç”Ÿäº§ç¯å¢ƒ**
```env
# ä½¿ç”¨å®é™…åŸŸåæˆ–IP
API_SERVICE_URL=http://api.fanzdnet.com:27001
AI_SERVICE_URL=http://ai.fanzdnet.com:27002
NEWS_SERVICE_URL=http://news.fanzdnet.com:27005
SCHEDULE_SERVICE_URL=http://schedule.fanzdnet.com:27006
API_GATEWAY_URL=http://gateway.fanzdnet.com:27007
```

## ğŸ”’ **å®‰å…¨é…ç½®**

### **é˜²ç«å¢™è§„åˆ™**
```bash
# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 3000    # å‰ç«¯
sudo ufw allow 27001   # APIæœåŠ¡
sudo ufw allow 27002   # AIæœåŠ¡
sudo ufw allow 27007   # APIç½‘å…³

# å†…éƒ¨æœåŠ¡ç«¯å£ä»…å…è®¸æœ¬åœ°è®¿é—®
sudo ufw deny 27005    # æ–°é—»æœåŠ¡
sudo ufw deny 27006    # èµ›ç¨‹æœåŠ¡
```

### **Nginxåå‘ä»£ç†é…ç½®**
```nginx
# /etc/nginx/sites-available/fanzdnet
server {
    listen 80;
    server_name fanzdnet.com;
    
    # å‰ç«¯åº”ç”¨
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # APIç½‘å…³
    location /api/ {
        proxy_pass http://localhost:27007;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ“Š **ç›‘æ§é…ç½®**

### **å¥åº·æ£€æŸ¥ç«¯ç‚¹**
- APIæœåŠ¡: http://localhost:27001/health
- AIæœåŠ¡: http://localhost:27002/health
- æ–°é—»æœåŠ¡: http://localhost:27005/health
- èµ›ç¨‹æœåŠ¡: http://localhost:27006/health
- APIç½‘å…³: http://localhost:27007/health

### **ç›‘æ§æŒ‡æ ‡ç«¯ç‚¹**
- AIæœåŠ¡ç›‘æ§: http://localhost:27008/metrics
- APIç½‘å…³ç›‘æ§: http://localhost:27009/metrics

## ğŸ› **æ•…éšœæ’é™¤**

### **å¸¸è§é—®é¢˜**

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥çœ‹å ç”¨è¿›ç¨‹
   lsof -i :ç«¯å£å·
   
   # æ€æ­»è¿›ç¨‹
   kill -9 PID
   ```

2. **æœåŠ¡æ— æ³•å¯åŠ¨**
   ```bash
   # æ£€æŸ¥é…ç½®æ–‡ä»¶
   cat backend/api-service/.env
   
   # æ£€æŸ¥æ—¥å¿—
   tail -f logs/api-service.log
   ```

3. **æœåŠ¡é—´é€šä¿¡å¤±è´¥**
   ```bash
   # æµ‹è¯•è¿æ¥
   curl http://localhost:27001/health
   curl http://localhost:27002/health
   ```

## ğŸ“ **æ›´æ–°è®°å½•**

- **2024-12-29**: å®Œæˆç«¯å£é‡æ–°åˆ†é…
  - APIæœåŠ¡: 3001 â†’ 27001
  - AIæœåŠ¡: 8000 â†’ 27002
  - æ–°å¢æ–°é—»æœåŠ¡: 27005
  - æ–°å¢èµ›ç¨‹æœåŠ¡: 27006
  - æ–°å¢APIç½‘å…³: 27007
- **2024-12-29**: åˆ é™¤ç”¨æˆ·ç®¡ç†å’Œå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
  - åˆ é™¤ç”¨æˆ·æœåŠ¡ (27003)
  - åˆ é™¤åª’ä½“æœåŠ¡ (27004)
  - åˆ é™¤ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€å›¾ç‰‡ä¸Šä¼ ç›¸å…³åŠŸèƒ½

---

**é…ç½®å®Œæˆï¼æ‰€æœ‰æœåŠ¡ç«¯å£å·²æŒ‰ç…§æ–°æ–¹æ¡ˆé‡æ–°åˆ†é…å¹¶æµ‹è¯•é€šè¿‡ã€‚** ğŸ‰
